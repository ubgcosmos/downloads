<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ethan Browser</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #0a0a0f;
  --bg-secondary: #12121a;
  --fg: #ffffff;
  --fg-muted: #a0a0b0;
  --accent: #3b82f6;
  --accent-hover: #2563eb;
  --accent-glow: rgba(59, 130, 246, 0.3);
  --success: #10b981;
  --warning: #f59e0b;
  --danger: #ef4444;
  --glass: rgba(255, 255, 255, 0.03);
  --glass-border: rgba(255, 255, 255, 0.08);
  --shadow: rgba(0, 0, 0, 0.5);
}

* {
  box-sizing: border-box;
}

body {
  margin: 0;
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
  background: linear-gradient(135deg, #0a0a0f 0%, #1a1a2e 100%);
  color: var(--fg);
  display: flex;
  flex-direction: column;
  height: 100vh;
  overflow: hidden;
}

header {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 12px 16px;
  background: var(--glass);
  backdrop-filter: blur(20px) saturate(180%);
  border-bottom: 1px solid var(--glass-border);
  flex-wrap: wrap;
  z-index: 100;
}

header button {
  background: var(--glass);
  color: var(--fg);
  border: 1px solid var(--glass-border);
  border-radius: 8px;
  padding: 8px 14px;
  cursor: pointer;
  transition: all 0.2s ease;
  font-weight: 500;
  font-size: 14px;
  display: flex;
  align-items: center;
  gap: 6px;
}

header button:hover {
  background: rgba(255, 255, 255, 0.08);
  border-color: rgba(255, 255, 255, 0.15);
  transform: translateY(-1px);
}

header button:active {
  transform: translateY(0);
}

#reloadBtn {
  font-size: 18px;
  padding: 8px 12px;
}

#adminBtn {
  margin-left: auto;
  background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(147, 51, 234, 0.1));
  border-color: rgba(59, 130, 246, 0.3);
}

#adminBtn:hover {
  background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(147, 51, 234, 0.2));
  box-shadow: 0 0 20px var(--accent-glow);
}

#urlBar {
  flex: 1;
  min-width: 200px;
  padding: 8px 14px;
  border-radius: 8px;
  border: 1px solid var(--glass-border);
  background: var(--bg-secondary);
  color: var(--fg-muted);
  font-size: 14px;
  pointer-events: none;
  font-family: 'Inter', monospace;
}

iframe {
  flex: 1;
  border: none;
  width: 100%;
  background: var(--bg);
}

footer {
  text-align: center;
  padding: 12px;
  font-size: 12px;
  color: var(--fg-muted);
  background: var(--glass);
  backdrop-filter: blur(20px);
  border-top: 1px solid var(--glass-border);
  font-weight: 500;
}

.modalBackdrop {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.75);
  backdrop-filter: blur(8px);
  z-index: 1000;
  animation: fadeIn 0.2s ease;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

@keyframes slideUp {
  from {
    opacity: 0;
    transform: translate(-50%, -45%);
  }
  to {
    opacity: 1;
    transform: translate(-50%, -50%);
  }
}

.modalWindow {
  display: none;
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
  padding: 28px;
  min-width: 320px;
  max-width: 90vw;
  color: white;
  box-shadow: 0 20px 60px var(--shadow), 0 0 0 1px rgba(255,255,255,0.05);
  z-index: 1001;
  text-align: center;
  animation: slideUp 0.3s cubic-bezier(0.16, 1, 0.3, 1);
}

.modalWindow h2 {
  margin: 0 0 16px 0;
  font-size: 24px;
  font-weight: 700;
  background: linear-gradient(135deg, #fff 0%, #a0a0b0 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.modalWindow p {
  color: var(--fg-muted);
  line-height: 1.6;
}

.modalWindow button {
  margin: 6px;
  padding: 10px 20px;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  color: white;
  font-weight: 600;
  font-size: 14px;
  transition: all 0.2s ease;
  font-family: 'Inter', sans-serif;
}

.modalWindow input {
  width: 100%;
  padding: 12px 16px;
  margin: 12px 0;
  border-radius: 8px;
  border: 1px solid var(--glass-border);
  background: var(--bg-secondary);
  color: white;
  font-family: 'Inter', sans-serif;
  font-size: 14px;
  transition: all 0.2s ease;
}

.modalWindow input:focus {
  outline: none;
  border-color: var(--accent);
  box-shadow: 0 0 0 3px var(--accent-glow);
}

button.primary {
  background: linear-gradient(135deg, var(--accent) 0%, #2563eb 100%);
  box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
}

button.primary:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4);
}

button.primary:active {
  transform: translateY(0);
}

button.ghost {
  background: var(--glass);
  border: 1px solid var(--glass-border);
}

button.ghost:hover {
  background: rgba(255, 255, 255, 0.08);
  border-color: rgba(255, 255, 255, 0.15);
}

#loadingOverlay {
  position: fixed;
  inset: 0;
  display: none;
  justify-content: center;
  align-items: center;
  background: rgba(10, 10, 15, 0.95);
  backdrop-filter: blur(10px);
  color: white;
  font-size: 18px;
  z-index: 999;
  flex-direction: column;
  gap: 16px;
}

#loadingOverlay.active {
  display: flex;
}

#loadingSpinner {
  width: 40px;
  height: 40px;
  border: 4px solid var(--glass-border);
  border-top-color: var(--accent);
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
}

@keyframes spin {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

#loadingText {
  font-weight: 500;
  color: var(--fg-muted);
}

#errorMessage {
  color: var(--danger);
  font-size: 14px;
  margin-top: 8px;
  font-weight: 500;
}

#versionStatus {
  margin: 20px 0;
  padding: 16px;
  border-radius: 12px;
  background: var(--glass);
  border: 1px solid var(--glass-border);
  transition: all 0.3s ease;
}

#versionMessage {
  font-size: 15px;
  font-weight: 500;
}

#welcomeButtons {
  margin-top: 20px;
  display: flex;
  gap: 8px;
  justify-content: center;
  flex-wrap: wrap;
}

#masterListLinks, #adminLinksContent {
  display: flex;
  flex-direction: column;
  gap: 8px;
  max-height: 400px;
  overflow-y: auto;
  padding-right: 4px;
}

#masterListLinks::-webkit-scrollbar, #adminLinksContent::-webkit-scrollbar {
  width: 6px;
}

#masterListLinks::-webkit-scrollbar-track, #adminLinksContent::-webkit-scrollbar-track {
  background: var(--bg-secondary);
  border-radius: 3px;
}

#masterListLinks::-webkit-scrollbar-thumb, #adminLinksContent::-webkit-scrollbar-thumb {
  background: var(--glass-border);
  border-radius: 3px;
}

#masterListLinks button, #adminLinksContent button {
  text-align: left;
  justify-content: flex-start;
}

/* Animations */
@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.5; }
}

.pulse {
  animation: pulse 2s ease-in-out infinite;
}
</style>
</head>
<body>

<header>
  <button id="reloadBtn" title="reload">‚ü≥</button>
  <button id="homeBtn">üè† home</button>
  <button id="gamesBtn">üéÆ games</button>
  <input id="urlBar" readonly placeholder="loading...">
  <button id="masterListBtn">üìã master list</button>
  <button id="adminBtn">üîí admin</button>
</header>

<div id="loadingOverlay">
  <div id="loadingSpinner"></div>
  <div id="loadingText">loading...</div>
</div>

<iframe id="webFrame" sandbox="allow-scripts allow-same-origin allow-forms"></iframe>
<footer>made by Ethan Tang | v1.0.4</footer>

<!-- Master List Modal -->
<div id="masterListBackdrop" class="modalBackdrop"></div>
<div id="masterListModal" class="modalWindow">
  <h2>üìã master list</h2>
  <p style="margin-bottom: 20px;">quick access to all pages</p>
  <div id="masterListLinks"></div>
  <button class="ghost" onclick="closeMasterList()" style="margin-top: 16px;">close</button>
</div>

<!-- Admin Login Modal -->
<div id="adminBackdrop" class="modalBackdrop"></div>
<div id="adminModal" class="modalWindow">
  <h2>üîí admin</h2>
  <p style="margin-bottom: 16px;">whats the password</p>
  <input type="password" id="adminPassword" placeholder="enter password">
  <div id="errorMessage"></div>
  <div style="display: flex; gap: 8px; justify-content: center; margin-top: 16px;">
    <button class="ghost" onclick="closeAdmin()">cancel</button>
    <button class="primary" onclick="checkAdminPassword()">submit</button>
  </div>
</div>

<!-- Admin Links Modal -->
<div id="adminLinksBackdrop" class="modalBackdrop"></div>
<div id="adminLinksModal" class="modalWindow">
  <h2>üîì admin Panel</h2>
  <p style="margin-bottom: 20px;">manage site views and my stuff</p>
  <div id="adminLinksContent"></div>
  <button class="ghost" onclick="closeAdminLinks()" style="margin-top: 16px;">close</button>
</div>

<!-- Welcome Modal -->
<div id="welcomeBackdrop" class="modalBackdrop"></div>
<div id="welcomeModal" class="modalWindow" style="max-width: 480px;">
  <h2>welcome</h2>
  <p style="margin: 16px 0;">
    i know what ur bout to do
  </p>
  <p style="margin: 16px 0;">
    use the <strong>master list</strong> to explore all available pages
  </p>
  <div id="versionStatus">
    <div id="versionMessage" class="pulse">üîÑ checking for updates...</div>
  </div>
  <div id="welcomeButtons">
    <button class="primary" onclick="closeWelcome()">continue</button>
  </div>
</div>

<script>
const allowedDomain = "https://ethanytangcodes.github.io";
const workerURL = "https://browserupdate.ethantytang11.workers.dev/version";
const adminLinksURL = "https://browser.ethantytang11.workers.dev/links/";
const adminPasswordURL = "https://browser.ethantytang11.workers.dev/password/";
const currentVersion = "1.0.4";
let ADMIN_PASSWORD = null;

const webFrame = document.getElementById("webFrame");
const urlBar = document.getElementById("urlBar");

let currentUrl = allowedDomain + "/index.html";

function showLoading(text = "Loading‚Ä¶") {
  document.getElementById("loadingText").textContent = text;
  document.getElementById("loadingOverlay").classList.add("active");
}
function hideLoading() {
  document.getElementById("loadingOverlay").classList.remove("active");
}

function loadUrl(url) {
  showLoading();
  currentUrl = url;
  webFrame.src = url;
  urlBar.value = url;
}

document.getElementById("reloadBtn").onclick = () => loadUrl(currentUrl);
document.getElementById("homeBtn").onclick = () => navigateTo("home");
document.getElementById("gamesBtn").onclick = () => navigateTo("games");

// sanitize URLs to prevent outside navigation
function sanitizeUrl(url) {
  try {
    const u = new URL(url, allowedDomain);
    return u.origin === new URL(allowedDomain).origin ? u.href : allowedDomain + "/index.html";
  } catch {
    return allowedDomain + "/index.html";
  }
}

// navigation helper
function navigateTo(route) {
  const routes = {
    home: "/index.html",
    games: "/art",
    proxy: "/active",
    sinerider: "/sinerider",
    gameboy: "/gamebois",
    darkroom: "/text-game"
  };
  loadUrl(sanitizeUrl(allowedDomain + (routes[route] || "/index.html")));
}

// iframe update listener
webFrame.addEventListener("load", () => {
  hideLoading();
  try {
    const iframeUrl = webFrame.contentWindow.location.href;
    if (iframeUrl && iframeUrl.startsWith(allowedDomain)) {
      currentUrl = iframeUrl;
      urlBar.value = iframeUrl;
    }
  } catch {
    urlBar.value = currentUrl;
  }
});

// Master List
const masterListBackdrop = document.getElementById("masterListBackdrop");
const masterListModal = document.getElementById("masterListModal");
const masterListLinks = document.getElementById("masterListLinks");

document.getElementById("masterListBtn").onclick = async () => {
  masterListLinks.innerHTML = "";
  try {
    const res = await fetch(adminLinksURL, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ request: 'links' })
    });
    if (res.ok) {
      const data = await res.json();
      const links = data.links || [];
      links.forEach(link => {
        const b = document.createElement("button");
        b.className = "ghost";
        b.textContent = link.label;
        b.onclick = () => { loadUrl(sanitizeUrl(link.url)); closeMasterList(); };
        masterListLinks.appendChild(b);
      });
    }
  } catch (e) {
    console.error("Failed to fetch master list:", e);
  }
  masterListBackdrop.style.display = "block";
  masterListModal.style.display = "block";
};

function closeMasterList() {
  masterListBackdrop.style.display = "none";
  masterListModal.style.display = "none";
}

// Admin
const adminBackdrop = document.getElementById("adminBackdrop");
const adminModal = document.getElementById("adminModal");
const adminPasswordInput = document.getElementById("adminPassword");
const errorMessage = document.getElementById("errorMessage");

document.getElementById("adminBtn").onclick = () => {
  adminPasswordInput.value = "";
  errorMessage.textContent = "";
  adminBackdrop.style.display = "block";
  adminModal.style.display = "block";
  setTimeout(() => adminPasswordInput.focus(), 100);
};

adminPasswordInput.addEventListener("keypress", (e) => {
  if (e.key === "Enter") checkAdminPassword();
});

async function fetchAdminPassword() {
  if (ADMIN_PASSWORD) return;
  try {
    const res = await fetch(adminPasswordURL, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ request: 'password' })
    });
    if (res.ok) {
      const data = await res.json();
      ADMIN_PASSWORD = data.password;
    }
  } catch (e) {
    console.error("failed to fetch admin password:", e);
  }
}

function checkAdminPassword() {
  if (adminPasswordInput.value === ADMIN_PASSWORD) {
    closeAdmin();
    openAdminLinks();
  } else {
    errorMessage.textContent = "haha you thought";
    adminPasswordInput.value = "";
    adminPasswordInput.focus();
  }
}

function closeAdmin() {
  adminBackdrop.style.display = "none";
  adminModal.style.display = "none";
}

// Admin Links
const adminLinksBackdrop = document.getElementById("adminLinksBackdrop");
const adminLinksModal = document.getElementById("adminLinksModal");
const adminLinksContent = document.getElementById("adminLinksContent");

async function openAdminLinks() {
  adminLinksContent.innerHTML = "";
  try {
    const res = await fetch(adminLinksURL, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ request: 'links' })
    });
    if (res.ok) {
      const data = await res.json();
      const links = data.links || [];
      links.forEach(link => {
        const b = document.createElement("button");
        b.className = "ghost";
        b.textContent = link.label;
        b.onclick = () => { loadUrl(sanitizeUrl(link.url)); closeAdminLinks(); };
        adminLinksContent.appendChild(b);
      });
    }
  } catch (e) {
    console.error("failed to fetch admin links:", e);
  }
  adminLinksBackdrop.style.display = "block";
  adminLinksModal.style.display = "block";
}

function closeAdminLinks() {
  adminLinksBackdrop.style.display = "none";
  adminLinksModal.style.display = "none";
}

// Welcome modal & version check
const welcomeBackdrop = document.getElementById("welcomeBackdrop");
const welcomeModal = document.getElementById("welcomeModal");
const versionMessage = document.getElementById("versionMessage");
const welcomeButtons = document.getElementById("welcomeButtons");

async function showWelcome() {
  welcomeBackdrop.style.display = "block";
  welcomeModal.style.display = "block";
  await checkVersionStatus();
}

function closeWelcome() {
  welcomeBackdrop.style.display = "none";
  welcomeModal.style.display = "none";
}

// version check
async function checkVersionStatus() {
  versionMessage.innerHTML = "üîÑ checking for updates";
  versionMessage.style.color = "#94a3b8";
  versionMessage.classList.add("pulse");

  await new Promise(r => setTimeout(r, 670));
  versionMessage.classList.remove("pulse");

  try {
    const res = await fetch(workerURL);
    const data = res.ok ? await res.json() : null;
    if (!data || !data.version || data.version === currentVersion) {
      versionMessage.innerHTML = "‚úÖ <strong>ur all up to date</strong><br><small>current version: " + currentVersion + "</small>";
      versionMessage.style.color = "var(--success)";
      return;
    }

    const latest = data.version;
    const currParts = currentVersion.split('.').map(Number);
    const latestParts = latest.split('.').map(Number);
    const diff = (latestParts[0] - currParts[0]) * 100 + (latestParts[1] - currParts[1]) * 10 + (latestParts[2] - currParts[2]);

    if (diff >= 2) {
      versionMessage.innerHTML = `üö® <strong>blud hasnt updated in a while now</strong><br><small>Current: ${currentVersion} ‚Üí Latest: ${latest}</small>`;
      versionMessage.style.color = "var(--danger)";
      welcomeButtons.innerHTML = `<button class="primary" onclick="window.location.href='${allowedDomain}/download'">update now (required)</button>`;
    } else {
      versionMessage.innerHTML = `‚ö†Ô∏è <strong>update available</strong><br><small>current: ${currentVersion} ‚Üí latest: ${latest}</small>`;
      versionMessage.style.color = "var(--warning)";
      welcomeButtons.innerHTML = `
        <button class="ghost" onclick="closeWelcome()">Skip</button>
        <button class="primary" onclick="window.location.href='${allowedDomain}/download'">update now</button>
      `;
    }
  } catch {
    versionMessage.innerHTML = "‚úÖ <strong>ur all up to date</strong><br><small>current version: " + currentVersion + "</small>";
    versionMessage.style.color = "var(--success)";
  }
}

window.onload = async () => {
  await fetchAdminPassword();
  loadUrl(currentUrl);
  showWelcome();
};
</script>
</body>
</html>
